# Authentication Testing Guide

Complete testing checklist for the hybrid authentication system.

## Test Environment Setup

1. Ensure PostgreSQL is running
2. Database is migrated: `npm run db:migrate`
3. `.env` file is configured
4. Dev server is running: `npm run dev`

## Test Cases

### 1. Anonymous User Access âœ…

**Test: URL Analysis Without Login**

1. Open http://localhost:3000
2. Verify "Sign In" and "Sign Up" buttons visible in header
3. Enter URL: `https://example.com`
4. Click "Analyze"
5. Wait for results page

**Expected Results:**
- âœ… Analysis completes successfully
- âœ… SEO score displayed
- âœ… GEO metrics visible
- âœ… AI insights show "Sign in to access AI-powered insights"
- âœ… No "Save Report" button visible
- âœ… Export buttons (PDF/Markdown) work

---

### 2. User Registration âœ…

**Test: Email/Password Registration**

1. Click "Sign Up" in header
2. Fill form:
   - Name: "Test User"
   - Email: "test@example.com"
   - Password: "password123"
   - Confirm Password: "password123"
3. Click "Sign Up"

**Expected Results:**
- âœ… Redirected to homepage
- âœ… Header shows "Dashboard" and "Sign Out" buttons
- âœ… Welcome message shows user name/email
- âœ… User record created in database

**Test: Validation**

1. Try registering with existing email
   - âœ… Error: "User already exists"

2. Try passwords that don't match
   - âœ… Error: "Passwords do not match"

3. Try password < 6 characters
   - âœ… Error: "Password must be at least 6 characters"

---

### 3. User Login âœ…

**Test: Credentials Login**

1. Sign out if logged in
2. Click "Sign In"
3. Enter credentials:
   - Email: "test@example.com"
   - Password: "password123"
4. Click "Sign In"

**Expected Results:**
- âœ… Redirected to homepage
- âœ… Authenticated state visible
- âœ… Session persists on page refresh

**Test: Invalid Credentials**

1. Try wrong password
   - âœ… Error: "Invalid email or password"

2. Try non-existent email
   - âœ… Error: "Invalid email or password"

---

### 4. OAuth Authentication âœ…

**Test: Google OAuth** (if configured)

1. Click "Sign In"
2. Click "Google" button
3. Complete Google OAuth flow

**Expected Results:**
- âœ… Redirected to Google
- âœ… After authorization, redirected back
- âœ… Logged in successfully
- âœ… User profile synced (name, email, image)

**Test: GitHub OAuth** (if configured)

1. Click "Sign In"
2. Click "GitHub" button
3. Complete GitHub OAuth flow

**Expected Results:**
- âœ… Redirected to GitHub
- âœ… After authorization, redirected back
- âœ… Logged in successfully
- âœ… User profile synced

---

### 5. Authenticated User Features âœ…

**Test: AI Insights Access**

1. Sign in
2. Analyze a URL
3. View results page

**Expected Results:**
- âœ… AI insights section shows actual suggestions (if OPENAI_API_KEY set)
- âœ… No "Sign in to access" message
- âœ… Summary and suggestions displayed

**Test: Save Report**

1. On results page, click "Save Report"
2. Wait for confirmation

**Expected Results:**
- âœ… Button changes to "Saved!"
- âœ… Button turns green
- âœ… Report saved to database
- âœ… Button resets after 3 seconds

**Test: View Dashboard**

1. Click "Dashboard" in header
2. View saved reports

**Expected Results:**
- âœ… All saved reports listed
- âœ… Shows URL, score, date
- âœ… "View Report" button works
- âœ… Reports sorted by date (newest first)

**Test: Delete Report**

1. In dashboard, click trash icon
2. Confirm deletion

**Expected Results:**
- âœ… Confirmation dialog appears
- âœ… Report removed from list
- âœ… Report deleted from database

---

### 6. Protected Routes âœ…

**Test: Dashboard Access Control**

1. Sign out
2. Try to access http://localhost:3000/dashboard

**Expected Results:**
- âœ… Redirected to sign-in page
- âœ… URL includes `callbackUrl=/dashboard`
- âœ… After sign-in, redirected back to dashboard

---

### 7. API Route Protection âœ…

**Test: Reports API Without Auth**

1. Sign out
2. Open browser console
3. Try to fetch reports:
   ```javascript
   fetch('/api/reports').then(r => r.json()).then(console.log)
   ```

**Expected Results:**
- âœ… Status: 401 Unauthorized
- âœ… Error: "Unauthorized"

**Test: Save Report Without Auth**

1. Try to save report while signed out:
   ```javascript
   fetch('/api/reports', {
     method: 'POST',
     headers: {'Content-Type': 'application/json'},
     body: JSON.stringify({url: 'test', score: 50, data: {}})
   }).then(r => r.json()).then(console.log)
   ```

**Expected Results:**
- âœ… Status: 401 Unauthorized
- âœ… Error: "Unauthorized"

---

### 8. Session Management âœ…

**Test: Session Persistence**

1. Sign in
2. Refresh page
3. Navigate to different pages

**Expected Results:**
- âœ… Remains logged in after refresh
- âœ… Session persists across pages
- âœ… User info consistent

**Test: Sign Out**

1. Click "Sign Out"
2. Verify signed out state

**Expected Results:**
- âœ… Redirected to homepage
- âœ… Header shows "Sign In" and "Sign Up"
- âœ… Cannot access protected routes
- âœ… Session cleared

---

### 9. Error Handling âœ…

**Test: Authentication Errors**

1. Try OAuth with invalid credentials
2. Visit `/auth/error?error=OAuthAccountNotLinked`

**Expected Results:**
- âœ… Error page displays
- âœ… Appropriate error message shown
- âœ… "Try Again" button works
- âœ… "Back to Home" button works

**Test: Network Errors**

1. Stop database
2. Try to sign in

**Expected Results:**
- âœ… Graceful error handling
- âœ… User-friendly error message
- âœ… No application crash

---

### 10. Data Integrity âœ…

**Test: User Ownership**

1. Sign in as User A
2. Save a report
3. Note the report ID
4. Sign out and sign in as User B
5. Try to access User A's report via URL

**Expected Results:**
- âœ… Cannot access other user's reports
- âœ… 403 Forbidden error
- âœ… Dashboard only shows own reports

**Test: Cascade Deletion**

1. Sign in
2. Save multiple reports
3. Delete user from database (via Prisma Studio)

**Expected Results:**
- âœ… All user's reports deleted
- âœ… Sessions deleted
- âœ… Accounts deleted
- âœ… No orphaned records

---

### 11. UI/UX Testing âœ…

**Test: Responsive Design**

1. Test on mobile viewport (375px)
2. Test on tablet viewport (768px)
3. Test on desktop viewport (1920px)

**Expected Results:**
- âœ… All pages responsive
- âœ… Forms usable on mobile
- âœ… Buttons accessible
- âœ… No horizontal scroll

**Test: Loading States**

1. Observe loading indicators during:
   - Sign in
   - Sign up
   - Saving report
   - Fetching dashboard

**Expected Results:**
- âœ… Loading states visible
- âœ… Buttons disabled during loading
- âœ… Clear feedback to user

**Test: Success Feedback**

1. Save a report
2. Delete a report
3. Sign in/out

**Expected Results:**
- âœ… Visual confirmation of actions
- âœ… Button state changes
- âœ… Smooth transitions

---

## Database Verification

Use Prisma Studio to verify data:

```bash
npm run db:studio
```

**Check:**
- âœ… Users table populated
- âœ… Passwords are hashed
- âœ… Reports linked to users
- âœ… Sessions created/destroyed
- âœ… OAuth accounts linked

---

## Performance Testing

**Test: Analysis Speed**

1. Time anonymous analysis
2. Time authenticated analysis

**Expected:**
- âœ… Similar performance (< 5s difference)
- âœ… No significant overhead from auth check

**Test: Dashboard Load**

1. Create 50+ reports
2. Load dashboard

**Expected:**
- âœ… Loads in < 2 seconds
- âœ… Pagination or limit working (50 reports max)

---

## Security Testing

**Test: Password Security**

1. Check database for password hashes
2. Verify bcrypt format

**Expected:**
- âœ… Passwords hashed (starts with `$2b$`)
- âœ… No plain text passwords

**Test: Session Security**

1. Inspect cookies in browser DevTools
2. Check session token

**Expected:**
- âœ… HttpOnly flag set
- âœ… Secure flag in production
- âœ… SameSite attribute set

**Test: SQL Injection**

1. Try malicious input in forms:
   - Email: `'; DROP TABLE users; --`
   - Password: `' OR '1'='1`

**Expected:**
- âœ… Prisma prevents injection
- âœ… No database errors
- âœ… Invalid credentials error

---

## Browser Compatibility

Test in:
- âœ… Chrome
- âœ… Firefox
- âœ… Safari
- âœ… Edge

**Expected:**
- âœ… All features work
- âœ… OAuth redirects work
- âœ… Sessions persist

---

## Test Summary Checklist

- [ ] Anonymous access works
- [ ] User registration works
- [ ] User login works
- [ ] OAuth providers work (if configured)
- [ ] AI insights restricted to auth users
- [ ] Save reports works
- [ ] Dashboard displays reports
- [ ] Delete reports works
- [ ] Protected routes redirect
- [ ] API routes protected
- [ ] Session persists
- [ ] Sign out works
- [ ] Error handling graceful
- [ ] Data ownership enforced
- [ ] UI responsive
- [ ] Loading states visible
- [ ] Database integrity maintained
- [ ] Passwords hashed
- [ ] Sessions secure
- [ ] Cross-browser compatible

---

## Automated Testing (Future)

Consider adding:
- Jest unit tests for API routes
- Playwright E2E tests for user flows
- Cypress component tests
- Load testing with k6

---

## Reporting Issues

If tests fail, collect:
1. Browser console errors
2. Network tab (failed requests)
3. Server logs
4. Database state (Prisma Studio)
5. Environment variables (redacted)

Happy Testing! ðŸ§ª
